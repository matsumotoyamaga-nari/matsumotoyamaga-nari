
import streamlit as st
from streamlit_calendar import calendar
import json
import os

DATA_FILE = "events.json"

def load_events():
    if os.path.exists(DATA_FILE):
        with open(DATA_FILE, "r", encoding="utf-8") as f:
            return json.load(f)
    return []

def save_events(events):
    with open(DATA_FILE, "w", encoding="utf-8") as f:
        json.dump(events, f, ensure_ascii=False, indent=2)

st.set_page_config(page_title="äºˆå®šã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼", layout="centered")
st.title("ğŸ“… ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼äºˆå®šã‚¢ãƒ—ãƒª")

events = load_events()

calendar_options = {
    "initialView": "dayGridMonth",
    "selectable": True,
    "locale": "ja",
    "height": 650,
}

state = calendar(events=events, options=calendar_options, key="calendar")

# æ—¥ä»˜ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰å…¥åŠ›æ¬„è¡¨ç¤º
if state.get("select_info"):
    date = state["select_info"]["start"][:10]
    st.session_state["date"] = date

if "date" in st.session_state:
    st.markdown("---")
    st.subheader(f"ğŸ—“ {st.session_state['date']} ã®äºˆå®šã‚’è¿½åŠ ")
    title = st.text_input("äºˆå®šã‚¿ã‚¤ãƒˆãƒ«")
    if st.button("ğŸ’¾ ä¿å­˜"):
        new_event = {
            "title": title if title else "äºˆå®š",
            "start": st.session_state["date"],
            "end": st.session_state["date"],
        }
        events.append(new_event)
        save_events(events)
        st.success("ä¿å­˜ã—ã¾ã—ãŸï¼")
        st.session_state.pop("date")
        st.experimental_rerun()
